{#
/**
* Theme layout to display a UCB Newsletter Page.
*
* Created by jnichol on 5/05/22
*/
#}

{{ attach_library('boulderD9_base/ucb-page') }}
{{ attach_library('boulderD9_base/ucb-newsletter') }}

{%
set classes = [
'node',
'node--type-' ~ node.bundle|clean_class,
not node.isPublished() ? 'node--unpublished',
view_mode ? 'node--view-mode-' ~ view_mode|clean_class,
]
%}

{#Dummy variable to ensure that all content tags are set for caching purposes#}
{% set content_render = content|render %}

{% set isLoggedIn = "false" %}
{% if logged_in %}
    {% set isLoggedIn = "true" %}
{% endif %}
{# TO DO -- 2nd line of concat, figure out how to get newsletter section paragraph fields and the nested paragraph field w/ from that #}
{# Builds JSON API endpoint for programmatic rendering #}
{% set API = '/jsonapi/node/newsletter?filter[nid]=' 
	~ node.id 
	~ '?fields[node--newsletter]=title,created,field_newsletter_block_text_one,field_newsletter_block_title_one,field_newsletter_promo_image_one,field_newsletter_promo_link_one,field_newsletter_intro_image,field_newsletter_intro_body,field_newsletter_type,field_newsletter_block_text_two,field_newsletter_block_title_two,field_newsletter_promo_image_two,field_newsletter_promo_link_two,field_newsletter_section_block'
	~ '&fields[paragraph--newsletter_section]=field_newsletter_section_link,field_newsletter_section_select,field_newsletter_section_style,field_newsletter_section_title'
	~ '&fields=field_newsletter_promo_image_one.field_media_image,field_newsletter_intro_image.field_media_image,field_newsletter_promo_image_two.field_media_image'
	~ '&fields[file--file]=uri,url'
%} 

<article{{attributes.addClass(classes)}}>
	<div
		class="container ucb-newsletter"
		data-loggedin="{{isLoggedIn}}"
		>
		{# Newsletter Title #}
		<h1 class="ucb-newsletter-title" itemprop="name">{{ content.field_newsletter_type }}</h1>
		<p> url : {{API}}</p>
		{# Newsletter Intro #}
		{% if content.field_newsletter_intro_image|render %}
			<div id="newsletter-intro-img">{{ content.field_newsletter_intro_image }}</div>
		{% endif %}
		{% if content.field_newsletter_intro_body|render %}
			<div id="newsletter-intro-body">{{ content.field_newsletter_intro_body }}</div>
		{% endif %}

		{# Newsletter Sections Content #}
		<div class="ucb-newsletter-section-content">
			{% if content.field_newsletter_section_block|render %}
				<div class="ucb-article-body">
					{{ content.field_newsletter_section_block }}
				</div>
			{% endif %}
		</div>

		{# Newsletter Promo/Ad One #}
		<div class="row row-content ucb-newsletter-promo-one">
			{% if content.field_newsletter_promo_image_one|render %}
				{% if content.field_newsletter_promo_link_one|render %}
					<a href="{{ content.field_newsletter_promo_link_one|render|striptags|trim }}">
					{{ content.field_newsletter_promo_image_one|render	}}
				</a>
				{% else %}	
					{{ content.field_newsletter_promo_image_one|render	}}
				{% endif %}
			{% endif %}
		</div>

		{# Newsletter Blocks #}
		<div class="row row-content ucb-newsletter-blocks">
			<div class="col-lg-6 col-12">
				{% if content.field_newsletter_block_title_one|render %}
					<h3>{{ content.field_newsletter_block_title_one|render }}</h3>
				{% endif %}

				{% if content.field_newsletter_block_text_one|render %}
					{{ content.field_newsletter_block_text_one|render }}
				{% endif %}
			</div>
			<div class="col-lg-6 col-12">
				{% if content.field_newsletter_block_title_two|render %}
					<h3>{{ content.field_newsletter_block_title_two|render }}</h3>
				{% endif %}

				{% if content.field_newsletter_block_text_two|render %}
					{{ content.field_newsletter_block_text_two|render }}
				{% endif %}
			</div>
		</div>

		{# Newsletter Promo/Ad Two #}
		<div class="row row-content ucb-newsletter-promo-one">
			{% if content.field_newsletter_promo_image_two|render %}
				{% if content.field_newsletter_promo_link_two|render %}
					<a href="{{ content.field_newsletter_promo_link_two|render|striptags|trim }}">
					{{ content.field_newsletter_promo_image_two|render	}}
				</a>
				{% else %}	
					{{ content.field_newsletter_promo_image_two|render	}}
				{% endif %}
			{% endif %}
		</div>
	</div>
</article>

<div class="container" id="email-preview" style="background-color: grey">
	<newsletter-component url='{{API}}'></newsletter-component>
</div>
{# 
{% if isLoggedIn == 'true' %}
<div class="container" id="email-preview" style="background-color: grey">

	<div id="email" style="width:600px;margin: auto;background:white;">		
		<!-- Header --> 
		<table role="presentation" border="0" width="100%" cellspacing="0">
		<tr>
			<h1 id="newsletter-email-title" style="padding: 30px 30px 15px 60px;font-size: 52px; margin:0 0 20px 0; font-family:Roboto, Helvetica Neue, Helvetica, Arial, sans-serif;"> Header</h1>
		  <td align="center" style="color: white;">
			<img id="newsletter-email-intro-img" src="" width="100%">
		  </tr>
		  {% if content.field_newsletter_intro_body|render %}
		  <tr>
			<td align='left' style="padding:35px 30px 15px 60px;font-family:Roboto, Helvetica Neue, Helvetica, Arial, sans-serif;">{{ content.field_newsletter_intro_body.0 }}</td>
		  </tr>
	  {% endif %}
			</td>
		</table>
		<!-- Articles --> 

		<div id="email-newsletter-article-section"></div>
 
		<div id="email-newsletter-promo-one-section"></div>

	  <!-- Blocks-->
	  <div id="email-newsletter-blocks-section"></div>
	  <!--Promo 2-->
	  <div id="email-newsletter-promo-two-section"></div>

	  </div>
</div>
{% endif %} #}
